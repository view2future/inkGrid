# inkGrid 产品执行方案

## 一、产品定位

**产品名称**: inkGrid - 智能书法名帖数字化平台

**核心价值**: 集高清展示、智能识别、多维语义对齐及文化脉络研究于一体的书法数字化移动应用

**目标用户**: 书法爱好者、专业研究者、书法学习者

---

## 二、产品功能模块

### 2.1浏览
 高清碑帖- 支持亿级像素图像的深度缩放（ Zoom）
- IIIDeepF 协议图像分发，毫秒级响应
- 页码导航、作者信息展示、文献关联

### 2.2 智能单字识别
- 点击任意字获取高清切片
- 自动关联简体字、拼音、释义、英文
- 异体字、繁简自动转化

### 2.3 文化知识图谱
- 书法家关系网络（师承、流派、朋友圈）
- 作品流传记录、收藏印记
- 字体风格演变脉络

### 2.4 AR 临摹对比
- 摄像头对准练习作品
- 自动提取笔画与名帖比对
- 提供书写反馈建议

---

## 三、核心技术难点攻克方案

### 难点一：亿级像素图像分发

**问题**: 移动端无法一次性加载全图

**方案**: IIIF 协议分层平铺技术

```
实施步骤:
1. 部署 Cantaloupe 或 Loris 图像服务器
2. 将高清图预切割为分层瓦片（Tiled Pyramid）
3. 前端使用 OpenSeadragon 或 Leaflet-IIIF
4. 按需请求当前视口瓦片
```

**URI 格式**:
```
{scheme}://{server}/{prefix}/{identifier}/{region}/{size}/{rotation}/{quality}.{format}
```

**预期效果**: 毫秒级缩放响应，极低带宽消耗

---

### 难点二：书法单字精准分割

**问题**: 书法作品排版差异大、字迹重叠、石花噪声

#### 方案 A：通用场景（无界格）

**技术**: YOLOv8n-seg-CAA-BiFPN 实例分割

```
实施步骤:
1. 收集并标注书法单字数据集（至少 10 万张）
2. 训练 YOLOv8n-seg + 坐标感知注意力机制 (CAA)
3. 双向特征金字塔融合 (BiFPN) 增强特征提取
4. 部署推理服务，按坐标提取每个字的边界框
```

**备选技术**:
- SAM (Segment Anything): 泛化强，需后处理
- dhSegment: 适合大规模文档布局分析

#### 方案 B：格内碑帖场景（有界格）【推荐优先落地】

**技术**: Grid-to-VLM 混合架构

```
实施步骤:
1. 界格检测：霍夫变换 (Hough Transform) 检测横竖直线
2. 计算直线交点，获取每个格子的 (x, y, w, h) 坐标
3. 模糊界格处理：二值化 + 投影分析找波谷
4. 利用 IIIF API 动态切图，不生成碎片文件
5. VLM 识别：CalliReader (InternVL2-8B 微调版)
```

**优势**: 跳过复杂分割，算法成本极低

**推荐优先开发碑帖**:
- 《九成宫醴泉铭》（楷）- 界格规整
- 《曹全碑》（隶）- 界格清晰
- 《泰山刻石》（篆）- 界格分明

---

### 难点三：异体字与繁简转化

**问题**: 名帖多为繁体/异体字，现代 OCR 无法识别

**方案**: Unihan 数据库语义桥接

```
实施步骤:
1. 集成 Unihan 数据库
2. 识别出的字头查询 kSimplifiedVariant 字段
3. 映射到标准简体 Unicode
4. 关联 CC-CEDICT 获取拼音、释义、英文
```

**数据流程**:
```
单字切片 → CalliReader 识别 → Unihan(简体ID) → CC-CEDICT(拼音+释义+英文)
```

---

### 难点四：大规模跨模态检索

**问题**: 用户搜索"颜真卿 祭侄文稿 竖排"等复杂查询

**方案**: CSTR-CLIP 检索架构

```
实施步骤:
1. 扩展 CLIP 模型的视觉感受野
2. 训练感知竖排、交错对齐等布局
3. 文本查询与图像区域精准匹配
4. 部署向量检索服务 (Milvus/Faiss)
```

---

### 难点五：书法文化知识图谱

**问题**: 碎片化信息无法展现历史关联

**方案**: 构建 WuMKG 领域本体

**本体结构**:
| 类 (Class) | 属性 | 示例 |
|-----------|-----|-----|
| 书法家 | 姓名、号、朝代、流派、师承 | 颜真卿→唐代→师承张旭 |
| 作品 | 名称、材质、现藏地、流传记录 | 《兰亭序》→晋代→台北故宫 |
| 字体样式 | 篆、隶、草、行、楷 | 圣教序→行书→秀逸 |
| 印章 | 创作者印、收藏印、鉴藏玺 | 乾隆御览之宝→清代 |

**存储**: Neo4j 图数据库

---

## 四、工程实施路线图

### 第一阶段：数据整合与存储（2-3周）

| 任务 | 工具 | 输出 |
|-----|-----|-----|
| 批量抓取故宫、国博 IIIF 数据 | Python + requests | 元数据 + 图像 URL 清单 |
| 部署图像服务器 | Cantaloupe/Loris | IIIF Image API 服务 |
| 数据库初始化 | PostgreSQL + PostGIS | 碑帖表、坐标表、作者表 |
| 知识图谱初始化 | Neo4j | 书法家、作品、印章节点 |

### 第二阶段：AI 识别流水线（4-6周）

| 任务 | 工具/模型 | 输出 |
|-----|----------|-----|
| 布局分析 | PDF-layout-analysis | 文本行、印章区域 |
| 单字分割（通用） | YOLOv8n-seg-CAA | 单字坐标 |
| 单字分割（格内） | OpenCV HoughLinesP + CalliReader | 单字切片 + 识别结果 |
| 语义关联 | Unihan + CC-CEDICT | 简体ID、拼音、释义、英文 |

### 第三阶段：前端开发（4-5周）

| 任务 | 框架 | 功能 |
|-----|-----|-----|
| 高清 viewer | Flutter + OpenSeadragon | 深度缩放、标注叠加 |
| 搜索模块 | React + CSTR-CLIP | 跨模态检索 |
| AR 临摹 | ARKit/ARCore | 笔画比对、反馈 |

---

## 五、推荐技术栈

### 后端
- **语言**: Python 3.11
- **Web 框架**: FastAPI
- **图像服务**: Cantaloupe (IIIF)
- **向量检索**: Milvus / Faiss
- **图数据库**: Neo4j
- **关系数据库**: PostgreSQL + PostGIS

### AI/ML
- **分割模型**: YOLOv8n-seg-CAA-BiFPN
- **VLM 模型**: CalliReader (InternVL2-8B 微调)
- **OCR**: PaddleOCR (备选)
- **古文字识别**: MCGI 框架

### 前端
- **移动端**: Flutter 3.0 / React Native
- **图像浏览**: OpenSeadragon
- **AR**: ARKit (iOS) / ARCore (Android)

### 基础设施
- **容器化**: Docker + Docker Compose
- **编排**: Kubernetes (生产环境)
- **CI/CD**: GitHub Actions
- **监控**: Prometheus + Grafana

---

## 六、关键数据源

| 数据源 | 内容 | 接入方式 |
|-------|-----|---------|
| 故宫博物院 | 5万+ 碑帖高清图 | IIIF Open Data 门户 |
| 历代书法碑帖集成 | 4268 门经典作品 | 数据库授权 |
| 美国史密森尼 | Freer & Sackler 收藏 | 在线目录 API |
| ZiNet | 1.6万+ 字形历时关系 | 知识库 API |
| CC-CEDICT | 12万+ 中英词条 | 开源文件 |
| Unihan | Unicode 汉字属性 | 开源文件 |

---

## 七、风险与应对

| 风险 | 等级 | 应对措施 |
|-----|-----|---------|
| 草书分割精度不足 | 高 | 优先落地格内碑帖；草书众包标注 |
| 博物馆 API 限制 | 中 | 建立本地缓存；多源冗余 |
| VLM 推理成本高 | 中 | GPU 推理优化；结果缓存 |
| 古文字识别误差 | 中 | 众包纠错机制；专家审核 |

---

## 八、里程碑

| 阶段 | 时间 | 交付物 |
|-----|-----|-------|
| M1 | 第 2 周 | IIIF 图像服务上线，100+ 碑帖接入 |
| M2 | 第 6 周 | 格内碑帖 Demo（楷/隶/篆各1本） |
| M3 | 第 10 周 | 全量碑帖分割完成，搜索功能上线 |
| M4 | 第 14 周 | App Beta 版发布，AR 临摹功能 |
| M5 | 第 16 周 | 正式版发布 |

---

## 九、后续演进方向

1. **书法真伪鉴别**: VLM 辅助鉴定
2. **残碑虚拟复原**: 生成式 AI 补全
3. **个性化教学**: 根据书写习惯推荐临摹
4. **风格迁移**: 书写风格转换
5. **社区功能**: 用户上传、点评、纠错

---

**文档版本**: v1.0
**更新日期**: 2026-02-09
