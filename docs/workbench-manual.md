# Workbench 工坊使用说明书

## 简介

Workbench 工坊是 inkGrid 的碑帖数字化工作台，帮助你将书法碑帖图片转换为结构化的字符数据集。支持 AI 自动分析和手动精细调整。

## 快速开始

### 1. 创建项目

1. 打开 Workbench 工坊界面
2. 在左侧「新建项目」区域输入：
   - **项目名称**：例如"倪宽赞"、"前后赤壁赋"
   - **碑帖路径**：自动生成的唯一标识符
   - **书写方向**：选择「从右到左竖排」(vertical_rtl) 或「从左到右横排」(horizontal_ltr)
   - **默认列数**：每页默认的列数（如 4-5 列）
   - **默认行数**：每页默认的行数（如 7-8 行）
3. 点击「创建项目」按钮

### 2. 上传页面图片

1. 在项目列表中选择刚创建的项目
2. 点击「上传页面」按钮
3. 选择碑帖扫描图片（支持 JPG、PNG 格式）
4. 等待图片上传完成
5. 图片将显示在 Pages 面板中

**提示**：建议按阅读顺序命名图片，如 `page_001.jpg`, `page_002.jpg`

## 核心功能

### 3. AI 自动分析布局

**适用场景**：快速生成初始的行列网格结构

**操作步骤**：
1. 在 Pages 面板中点击要分析的页面
2. 点击右上角的「**AI 分析**」按钮
3. 等待分析完成（约 10-30 秒）
4. 分析结果将自动保存到该页面

**AI 分析会检测**：
- 列数和行数
- 每个字符的位置边界
- 生成可视化参考图

**注意事项**：
- AI 分析结果仅供参考，可能需要手动调整
- 传统书法的识别准确率有限（约 20-30%）
- 建议用于生成初始网格，后续手动优化

### 4. 手动调整布局

**打开编辑器**：
1. 在 Pages 面板中选择页面
2. 点击「**Edit**」按钮进入页面编辑器

**调整方式**：

#### 方式一：拖拽边框（推荐）
- **蓝色竖线** = 列边界
- **绿色横线** = 行边界
- 鼠标悬停在线条上，光标变成 ↔️ 或 ↕️
- 按住拖拽即可调整位置

#### 方式二：快捷键辅助
- **Alt 键**：关闭自动吸附，自由拖动
- **Shift 键**：强制吸附到最近的参考线
- 默认吸附范围：12 像素

#### 方式三：右侧面板精确调整
- 查看当前列/行的预览缩略图
- 切换不同的"道"（列或行）进行精细调整
- 在 Pages 面板中直接修改行列数覆盖

**保存调整**：
1. 点击「**Apply**」按钮应用修改
2. 或点击「**Preview**」预览分割效果
3. 关闭编辑器回到主界面

**撤销/重做**：
- 编辑器内支持 **Undo/Redo**（Ctrl+Z / Ctrl+Y）
- 调整过程中自动保存历史记录

### 5. 文本对齐与校对

**添加文本**：
1. 在「文本对齐」面板点击「获取推荐文本」
2. 系统会从 Wikipedia 等来源搜索相关文本
3. 选择最接近的文本版本
4. 点击「保存对齐文本」

**校对流程**：
1. 打开 Annotation 标注工具
2. 对照碑帖图片逐个核对字符
3. 修正识别错误的文字
4. 标记疑难字符

### 6. 导出数据集

**准备工作**：
1. 确保所有页面都已完成布局调整
2. 完成文本对齐和校对
3. 检查无误后点击「**开始导出**」按钮

**导出选项**：
- **导出前缀**：数据集文件夹名称前缀
- **包含文件**：
  - `index.json` - 字符索引
  - 切割好的字符图片
  - 叠加层可视化图片
  - `qa_summary.md` - 质量报告

**下载数据集**：
1. 导出完成后生成 ZIP 压缩包
2. 点击下载链接保存到本地
3. 解压后可用于训练或其他用途

## 工作流程建议

### 推荐的工作顺序

```
创建项目 → 上传图片 → AI分析 → 手动调整 → 文本对齐 → 导出数据集
    ↑___________________________________________________________↓
                    （循环优化）
```

### 批量处理技巧

**批量设置行列**：
1. 在 Pages 面板中勾选多个页面（按住 Shift 或 Cmd 点击）
2. 选择「方向」、「列数」、「行数」
3. 点击「应用覆盖」批量设置

**批量应用 AI 分析**：
- 目前需要逐个页面点击「AI 分析」
- 后续版本将支持批量分析

## 界面说明

### 主界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  inkGrid Workbench                                    [帮助] │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────────────────────────────┐ │
│  │              │  │                                      │ │
│  │  项目列表     │  │          Pages 页面面板               │ │
│  │              │  │                                      │ │
│  │ • 倪宽赞     │  │  ┌──────────┐  ┌──────────────────┐ │ │
│  │ • 赤壁赋     │  │  │ 页面列表  │  │    图片预览       │ │ │
│  │              │  │  │          │  │                  │ │ │
│  │  + 新建项目  │  │  │ □ page1  │  │  ┌────────────┐  │ │ │
│  │              │  │  │ □ page2  │  │  │            │  │ │ │
│  │              │  │  │          │  │  │   碑帖图片  │  │ │ │
│  │              │  │  └──────────┘  │  │            │  │ │ │
│  │              │  │                │  └────────────┘  │ │ │
│  │              │  │                │  [AI分析] [Edit] │ │ │
│  └──────────────┘  └──────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  ┌────────────────────────┐  ┌────────────────────────────┐ │
│  │    文本对齐面板         │  │      项目设置面板           │ │ │
│  │                        │  │                            │ │
│  │ [获取推荐文本]          │  │  方向: vertical_rtl         │ │
│  │                        │  │  默认: 5列 x 7行           │ │
│  └────────────────────────┘  └────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### Pages 面板说明

- **左侧列表**：所有页面的缩略图和文件名
- **复选框**：多选进行批量操作
- **标签**：
  - `layout` = 已有布局数据
  - `no layout` = 尚未设置布局
  - `override` = 使用了自定义行列数
- **右侧预览**：当前选中页面的完整图片
- **操作按钮**：
  - `AI 分析` = 自动检测行列
  - `Edit` = 手动调整布局
  - `Up/Down` = 调整页面顺序
  - `Delete` = 删除页面

### 页面编辑器说明

**顶部工具栏**：
- **Preview** = 预览当前布局的分割效果
- **Init Layout** = 初始化布局（如果没有）
- **Apply** = 保存当前调整
- **Confirm Export** = 确认并导出
- **Close** = 关闭编辑器

**左侧控制**：
- `+/-` = 放大/缩小
- **Fit** = 适应窗口
- **Reset** = 重置视图
- **Show/Hide** = 显示/隐藏右侧面板
- **Undo/Redo** = 撤销/重做

**编辑区域**：
- 显示碑帖原图
- 叠加半透明网格线
- 红色边框 = 字符太靠近边缘（风险提示）

**右侧面板**：
- 显示当前选中的列/行的缩略图
- 每个格子的切割预览

## 常见问题

### Q: AI 分析结果不准确怎么办？
A: 这是正常现象。AI 主要用于快速生成初始框架，你需要：
1. 点击「Edit」进入编辑器
2. 拖拽蓝色/绿色线条调整边框
3. 使用 Alt 键关闭吸附进行精细调整
4. 点击「Apply」保存

### Q: 如何处理不规则的碑帖布局？
A: 支持每页单独设置行列数：
1. 在 Pages 面板选择特定页面
2. 修改右侧的 cols/rows 覆盖值
3. 或使用 Edit 编辑器拖拽调整

### Q: 导出的数据集质量不好？
A: 检查以下几点：
1. 确保所有页面的行列边框都准确
2. 红色边框提示表示字符太靠近边缘，需要调整
3. 在 Annotation 工具中校对文本内容
4. 重新导出前删除旧的数据集

### Q: 支持哪些图片格式？
A: 支持 JPG、PNG 格式。建议：
- 分辨率：至少 2000px 宽度
- 格式：JPG（压缩较好）或 PNG（无损）
- 命名：使用有意义的名称，如 `page_001.jpg`

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| Ctrl + Z | 撤销 |
| Ctrl + Y | 重做 |
| Alt + 拖拽 | 关闭吸附，自由拖动 |
| Shift + 拖拽 | 强制吸附到参考线 |
| +/- | 放大/缩小 |

## 技术支持

如有问题，请访问：
- GitHub Issues: https://github.com/anomalyco/inkGrid/issues
- 文档: https://opencode.ai

---

**版本**: v1.0  
**最后更新**: 2026-02-19
